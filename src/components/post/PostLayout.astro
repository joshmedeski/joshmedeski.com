---
import clsx from "clsx";
import Layout from "../Layout.astro";
import { getEntry } from "astro:content";
import type { CollectionEntry } from "astro:content";
import CategoryIcon from "../CategoryIcon.astro";
import Wrapper from "../Wrapper.astro";

interface Props {
  post: CollectionEntry<"posts">;
}

const {
  post: {
    data: {
      title,
      description,
      pubDate,
      updatedDate,
      heroImage,
      category: postCategory,
      heroClasses,
      youtubeUrl,
    },
  },
} = Astro.props;

const category = await getEntry(postCategory);
---

<Layout
  title={title}
  description={description}
  image={heroImage}
  themeColor={category.data.style.themeColor}
>
  <section
    class="pt-[350px]"
    style={`background-color: ${category.data.style.themeColor}`}
  >
  </section>
  <section class="mt-[-300px]">
    <Wrapper>
      <section class="mb-20 flex flex-row-reverse">
        <div class="relative w-full">
          <div class="sticky top-4 z-40 mb-6 ml-6">
            {
              youtubeUrl && (
                <div class="mb-4 rounded-md shadow-lg">
                  <iframe
                    width="100%"
                    height="100%"
                    class="aspect-video w-full rounded-md bg-black shadow-lg"
                    src={youtubeUrl}
                    title="YouTube video player"
                    frameborder="0"
                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                    allowfullscreen
                  />
                </div>
              )
            }
            {
              !youtubeUrl && (
                <img
                  class:list={[
                    heroClasses,
                    "bg-black w-full rounded-md shadow-lg aspect-video",
                  ]}
                  src={heroImage}
                  alt={`${title} hero`}
                />
              )
            }
          </div>
        </div>

        <article class="w-full">
          <h1 class="mb-3 mt-10 text-2xl font-extrabold md:text-4xl">
            {title}
          </h1>

          <section class="mb-6">
            <div
              class={clsx(
                "flex space-x-2 font-medium",
                category.data.style.desc
              )}
            >
              <a
                href={`/categories/${category.slug}`}
                class={clsx("mr-2 block")}
              >
                {category.data.title}
              </a>
              {
                pubDate && (
                  <time>
                    {new Date(pubDate).toLocaleDateString("en-US", {
                      dateStyle: "long",
                    })}
                  </time>
                )
              }
              {
                updatedDate && (
                  <div class="text-neutral-400">
                    Last updated on <time>{updatedDate}</time>
                  </div>
                )
              }
            </div>
          </section>

          <main
            class="prose -ml-6 rounded-t-lg bg-white px-6 pt-5 prose-a:text-blue-600 hover:prose-a:text-blue-500"
          >
            <slot />
          </main>
        </article>
      </section>
    </Wrapper>
  </section>

  <slot name="after-post" />
</Layout>
