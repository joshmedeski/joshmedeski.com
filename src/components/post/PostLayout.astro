---
import clsx from "clsx";
import Layout from "../Layout.astro";
import { getEntry } from "astro:content";
import type { CollectionEntry } from "astro:content";
import CategoryIcon from "../CategoryIcon.astro";

interface Props {
  post: CollectionEntry<"posts">;
}

const {
  post: {
    data: {
      title,
      description,
      pubDate,
      updatedDate,
      heroImage,
      category: postCategory,
      heroClasses,
      youtubeUrl,
    },
  },
} = Astro.props;

const category = await getEntry(postCategory);
---

<Layout
  title={title}
  description={description}
  image={heroImage}
  themeColor={category.data.style.themeColor}
>
  <header
    style={`background-color: ${category.data.style.themeColor}`}
    class={clsx(!heroImage && !youtubeUrl && "pb-4")}
  >
    <div class="mx-auto mb-10 max-w-screen-md px-4 pt-10 text-center">
      <a href={`/categories/${category.slug}`}>
        <CategoryIcon slug={category.slug} class="mx-auto mb-4 w-10" />
      </a>
      <h1 class="mb-2 text-2xl font-extrabold md:text-4xl">{title}</h1>
      <div
        class={clsx(
          "flex justify-center space-x-2 font-medium",
          category.data.style.desc
        )}
      >
        <a href={`/categories/${category.slug}`} class={clsx("mr-2 block")}>
          {category.data.title}
        </a>
        {
          pubDate && (
            <time>
              {new Date(pubDate).toLocaleDateString("en-US", {
                dateStyle: "long",
              })}
            </time>
          )
        }
        {
          updatedDate && (
            <div class="text-neutral-400">
              Last updated on <time>{updatedDate}</time>
            </div>
          )
        }
      </div>
    </div>

    {
      (youtubeUrl || heroImage) && (
        <div class="z-40 mx-auto -mb-24 max-w-screen-sm">
          {youtubeUrl && (
            <div class="mb-4 rounded-md shadow-lg">
              <iframe
                width="100%"
                height="100%"
                class="aspect-video w-full rounded-md bg-black shadow-lg"
                src={youtubeUrl}
                title="YouTube video player"
                frameborder="0"
                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                allowfullscreen
              />
            </div>
          )}
          {heroImage && !youtubeUrl && (
            <img
              class:list={[
                heroClasses,
                "bg-black w-full rounded-md shadow-lg aspect-video",
              ]}
              src={heroImage}
              alt={`${title} hero`}
            />
          )}
        </div>
      )
    }
  </header>

  <main class={clsx("bg-white mb-20 mt-32")}>
    <article
      class="prose mx-auto max-w-screen-md bg-white px-4 prose-a:text-blue-600 hover:prose-a:text-blue-500"
    >
      <slot />
    </article>
  </main>
</Layout>
