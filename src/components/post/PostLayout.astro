---
import type { CollectionEntry } from "astro:content";
import { getEntry } from "astro:content";
import Layout from "../Layout.astro";
import Wrapper from "../Wrapper.astro";
import PostMeta from "./PostMeta.astro";

interface Props {
  post: CollectionEntry<"posts">;
}

const { post } = Astro.props;
const category = await getEntry(post.data.category);
---

<Layout
  title={post.data.title}
  description={post.data.description}
  image={post.data.heroImage}
  themeColor={category.data.style.themeColor}
>
  <div
    class="mb-[20px] pt-[350px]"
    style={`background-color: ${category.data.style.themeColor}`}
  >
  </div>
  <section class="-mt-[300px]">
    <Wrapper>
      <section class="mb-20 md:flex md:flex-row-reverse">
        <div class="relative flex-auto">
          <div class="top-4 z-40 w-full md:sticky">
            {
              post.data.youtubeUrl ? (
                <div class="rounded-xl shadow-lg">
                  <iframe
                    width="100%"
                    height="100%"
                    class="aspect-video w-full rounded-xl bg-black shadow-lg"
                    src={post.data.youtubeUrl}
                    title="YouTube video player"
                    frameborder="0"
                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                    allowfullscreen
                  />
                </div>
              ) : (
                <img
                  class:list={[
                    post.data.heroClasses,
                    "bg-black w-full rounded-xl shadow-lg aspect-video",
                  ]}
                  src={post.data.heroImage}
                  alt={`${post.data.title} hero`}
                />
              )
            }
          </div>
        </div>

        <article class="max-w-prose flex-none">
          <h1 class="mb-6 mr-6 mt-10 text-2xl font-extrabold md:text-4xl">
            {post.data.title}
          </h1>

          <div class="mb-4 mr-6">
            <PostMeta post={post} />
          </div>

          <main
            class="prose -ml-6 max-w-full rounded-t-lg bg-white px-6 pt-5 prose-a:text-blue-600 hover:prose-a:text-blue-500"
          >
            <slot />
          </main>
        </article>
      </section>
    </Wrapper>
  </section>

  <slot name="after-post" />
</Layout>
